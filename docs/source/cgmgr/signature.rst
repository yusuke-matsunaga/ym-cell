
.. _signature:

セルの分類
=================

セルグループとセルクラス
--------------------------

通常，ライブラリには同一の機能を持つ複数のセルが存在する．
その目的は遅延時間や消費電力を調整するためのもので，
低速，低消費電力，小面積のものから高速，高消費電力，大面積
のものまで数種類用意されている場合が多い．
また，NANDゲートとNORゲートの様に入出力ピンの極性を反転すると
機能が等価となるセルも存在する．

そこで，機能が等しいセルの集合を `cell group` と呼ぶこととし，
入出力ピンの極性反転および順序の変更(NPN変換)で一致する `cell group` の集合を
`cell class` と呼ぶことにする．
これらはそれぞれ `ClibCellGroup` および `ClibCellClass` クラスに対応し
ている．

シグネチャを用いたセルの分類
------------------------------

通常のセルライブラリの記述ではこれらのセルの関係を明示的には示されていない．
そこで，読み込んだ記述から自動的にこのような分類を行う必要がある．
この目的にためにセルのシグネチャを定義する．
シグネチャは以下の性質を持つ必要がある．

* 同一の機能を持つセルのシグネチャは等しい．つまり，カノニカル性を持つ．

* NPN変換を施して得られる同位体のなかで唯一に代表元を定めることができる．

以上の性質を持つようなシグネチャを定めることができれば，各セルのシグネ
チャを求め，シグネチャの等しいセルをグループにすればよい．
また，各シグネチャに対するNPN同値類の代表元を求め，
同一の代表元を持つシグネチャのグループを集めればそれが一つのセルクラス
になる．

シグネチャの決め方
-------------------

前述のような性質を持つシグネチャの作り方は唯一ではなく様々なものが考え
られるが，
ここでは以下のように定める．

* 組み合わせ論理セルの場合

  出力の論理関数，および出力の tri-state 条件を表す関数の真理値表を用
  いる．
  基本的に真理値表そのものがカノニカルであるので同一の関数を持つセルの
  シグネチャは同一となる．
  真理値表の表現自体はさまざまなものが考えられるが例えば真理値表ベクタ
  を16進表記した文字列などが考えられる．
  なお，真理値表のサイズは入力数の指数乗( :math:`2^n` )であるが通常の
  セルの入力数はたかだか6以下なので問題はない．

  実際には真理値表を表すシグネチャの前に入力数，出力数，入出力数を表す
  シグネチャも必要となる．
  そこで，具体的には以下の様になる．

  ::

     <入力数>:<出力数>:<入出力数>:<出力1の論理関数><出力2の論理関数>...<出力1のtri-state条件><出力2のtri-state条件>


  tri-state 条件がない場合は恒偽関数(すべて0)を用いる．

* 順序セル(FF，ラッチ)の場合

  出力の論理関数，tri-state条件以外に以下の関数もシグネチャに含める．

  * クロック(イネーブル)のトリガー条件

  * クロック2(イネーブル2)のトリガー条件

  * 内部状態の遷移関数

  * 内部状態の非同期クリア(リセット)条件

  * 内部状態の非同期セット(プリセット)条件

  上記に加えて非同期クリアと非同期セットの同時が成り立ったときの振る舞
  いもシグネチャに含める必要がある．

  出力関数，tri-state条件および内部状態の遷移関数は内部状態を表す変数
  q とその否定 iq も入力として考える．
